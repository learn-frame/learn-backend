
services:
  etcd-node1:
    image: ${ETCD_IMAGE}
    container_name: ${ETCD_NAME_1}
    restart: 'always'
    environment:
      - TZ=${ETCD_TIMEZONE}
      - ALLOW_NONE_AUTHENTICATION=${ETCD_ALLOW_NONE_AUTHENTICATION}
      - ETCD_NAME=${ETCD_NAME_1}
      - ETCD_DATA_DIR=${ETCD_DATA_DIR}
      - ETCD_INITIAL_CLUSTER_STATE=${ETCD_INITIAL_CLUSTER_STATE}
      - ETCD_INITIAL_CLUSTER=${ETCD_NAME_1}=http://${ETCD_HOST_1}:${ETCD_PEER_PORT},${ETCD_NAME_2}=http://${ETCD_HOST_2}:${ETCD_PEER_PORT},${ETCD_NAME_3}=http://${ETCD_HOST_3}:${ETCD_PEER_PORT}
      - ETCD_INITIAL_ADVERTISE_PEER_URLS=http://${ETCD_HOST_1}:${ETCD_PEER_PORT}
      - ETCD_ADVERTISE_CLIENT_URLS=http://${ETCD_HOST_1}:${ETCD_CLIENT_PORT_1}
      - ETCD_LISTEN_PEER_URLS=http://0.0.0.0:${ETCD_PEER_PORT}
      - ETCD_LISTEN_CLIENT_URLS=http://0.0.0.0:${ETCD_CLIENT_PORT_1}
      - ETCD_INITIAL_CLUSTER_TOKEN=${ETCD_INITIAL_CLUSTER_TOKEN}
    ports:
      - ${ETCD_CLIENT_PORT_1}:${ETCD_CLIENT_PORT_1}
    volumes:
      - etcd-data-1:${ETCD_DATA_DIR}

  etcd-node2:
    image: ${ETCD_IMAGE}
    container_name: ${ETCD_NAME_2}
    restart: 'always'
    environment:
      - TZ=${ETCD_TIMEZONE}
      - ALLOW_NONE_AUTHENTICATION=${ETCD_ALLOW_NONE_AUTHENTICATION}
      - ETCD_NAME=${ETCD_NAME_2}
      - ETCD_DATA_DIR=${ETCD_DATA_DIR}
      - ETCD_INITIAL_CLUSTER_STATE=${ETCD_INITIAL_CLUSTER_STATE}
      - ETCD_INITIAL_CLUSTER=${ETCD_NAME_1}=http://${ETCD_HOST_1}:${ETCD_PEER_PORT},${ETCD_NAME_2}=http://${ETCD_HOST_2}:${ETCD_PEER_PORT},${ETCD_NAME_3}=http://${ETCD_HOST_3}:${ETCD_PEER_PORT}
      - ETCD_INITIAL_ADVERTISE_PEER_URLS=http://${ETCD_HOST_2}:${ETCD_PEER_PORT}
      - ETCD_ADVERTISE_CLIENT_URLS=http://${ETCD_HOST_2}:${ETCD_CLIENT_PORT_2}
      - ETCD_LISTEN_PEER_URLS=http://0.0.0.0:${ETCD_PEER_PORT}
      - ETCD_LISTEN_CLIENT_URLS=http://0.0.0.0:${ETCD_CLIENT_PORT_2}
      - ETCD_INITIAL_CLUSTER_TOKEN=${ETCD_INITIAL_CLUSTER_TOKEN}
    ports:
      - ${ETCD_CLIENT_PORT_2}:${ETCD_CLIENT_PORT_2}
    volumes:
      - etcd-data-2:${ETCD_DATA_DIR}

  etcd-node3:
    image: ${ETCD_IMAGE}
    container_name: ${ETCD_NAME_3}
    restart: 'always'
    environment:
      - TZ=${ETCD_TIMEZONE}
      - ALLOW_NONE_AUTHENTICATION=${ETCD_ALLOW_NONE_AUTHENTICATION}
      - ETCD_NAME=${ETCD_NAME_3}
      - ETCD_DATA_DIR=${ETCD_DATA_DIR}
      - ETCD_INITIAL_CLUSTER_STATE=${ETCD_INITIAL_CLUSTER_STATE}
      - ETCD_INITIAL_CLUSTER=${ETCD_NAME_1}=http://${ETCD_HOST_1}:${ETCD_PEER_PORT},${ETCD_NAME_2}=http://${ETCD_HOST_2}:${ETCD_PEER_PORT},${ETCD_NAME_3}=http://${ETCD_HOST_3}:${ETCD_PEER_PORT}
      - ETCD_INITIAL_ADVERTISE_PEER_URLS=http://${ETCD_HOST_3}:${ETCD_PEER_PORT}
      - ETCD_ADVERTISE_CLIENT_URLS=http://${ETCD_HOST_3}:${ETCD_CLIENT_PORT_3}
      - ETCD_LISTEN_PEER_URLS=http://0.0.0.0:${ETCD_PEER_PORT}
      - ETCD_LISTEN_CLIENT_URLS=http://0.0.0.0:${ETCD_CLIENT_PORT_3}
      - ETCD_INITIAL_CLUSTER_TOKEN=${ETCD_INITIAL_CLUSTER_TOKEN}
    ports:
      - ${ETCD_CLIENT_PORT_3}:${ETCD_CLIENT_PORT_3}
    volumes:
      - etcd-data-3:${ETCD_DATA_DIR}

volumes:
  etcd-data-1:
  etcd-data-2:
  etcd-data-3:
